#!/bin/env bash

system_type=
scriptfile=

echo ""
echo -e "\e[31mChecking permissions...\e[0m"

if [ "$EUID" -eq 0 ]; then
    echo ""
	echo "Please do not run this script as root (e.g. using sudo)"
	exit
fi

if [ -f "/etc/artix-release" ]; then
    if [ -d "/etc/runit/runsvdir/default" ]; then
        system_type="artix"
    else
        echo "Only Artix-runit is supported"
        exit 1
    fi
elif [ -f "/etc/arch-release" ]; then
	system_type="arch"
elif [ -f "/etc/os-release" ]; then
	if grep -q "obarun" "/etc/os-release" >/dev/null; then
		system_type="obarun"
    elif grep -q "void" "/etc/os-release" >/dev/null; then 
        system_type="void"
	else
		echo "Unknown system. Exiting.(1)"
		exit 1
	fi
else
	echo "Unknown syste. Exiting.(2)"
	exit 1
fi

case "$system_type" in
    "void")
        scriptfile="$HOME/.config/yadm/deps-void.sh"
        ;;
    "arch"|"artix"|"obarun")
        scriptfile="$HOME/.config/yadm/deps-artix.sh"
        ;;
    *)
        echo ""
        echo "Cannot identify system or system not supported."
        exit 1
        ;;
esac

if [ -z "$scriptfile" ]; then
    echo ""
    echo "Cannot find install script for ${system_type}Linux. Exiting."
    exit 1
fi

echo ""
echo -e "\e[31mInstalling for ${system_type}Linux.\e[0m"
read -p "Do you want to proceed? " reply
case "$reply" in
    y|yes|Y|YES)
        ;;
    *)
        echo ""
        echo "Installation cancelled."
        exit 1
        ;;
esac

. "$scriptfile" "$system_type"
