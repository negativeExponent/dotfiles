#!/bin/sh

# rofi power menu
cmd_logout=" Log out"
cmd_lock=" Lock"
cmd_suspend="鈴 Suspend"
cmd_reboot=" Reboot"
cmd_shutdown=" Shutdown"

options="$cmd_logout\\n$cmd_lock\\n$cmd_suspend\\n$cmd_reboot\\n$cmd_shutdown"
chosen=$(printf "$options" |
    rofi -p "Power Menu" -dmenu -i -theme "~/.config/rofi/powermenu.rasi")

# For non-systemd init systems.
case "$(readlink -f /sbin/init)" in
	*runit*) hib="sudo -A zzz" ;;
	*openrc*) reb="sudo -A openrc-shutdown -r"; shut="sudo -A openrc-shutdown -p" ;;
esac

killprogs() {
    pkill -x polybar
}

case "$chosen" in
    $cmd_logout)
        # For each opened window
        bspc query --nodes | while read -r winid; do
            # Close it
            xdotool windowkill "$winid"
        done
        killprogs
        bspc quit 1
        ;;
    $cmd_lock)
        #betterlockscreen --lock dimblur;;
        ;;
    $cmd_suspend)
        #systemctl suspend;;
        ;;
    $cmd_reboot)
        killprogs
        ${reb:-sudo -A reboot}
        ;;
    $cmd_shutdown)
        killprogs
        ${shut:-sudo -A shutdown -h now}
        ;;
esac
